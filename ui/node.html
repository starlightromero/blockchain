<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Blockchain Management</title>
  <link rel="stylesheet" href="/static/css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js" defer></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js" defer></script>
  <script type="text/javascript" src="/static/vue/node.vue" defer></script>
</head>

<body>
  <div id="app">
    <header>
      <h1>MS Coin</h1>
      <nav>
        <ul>
          <li>
            <a class="active" href="/">Wallet</a>
          </li>
          <li>
            <a href="/network">Network</a>
          </li>
        </ul>
      </nav>
    </header>
    <main>
      <div v-if="error" role="alert">
        {{ error }}
      </div>
      <div v-if="success" role="alert">
        {{ success }}
      </div>
      <div class="wallet">
        <div class="wallet-actions">
          <div v-if="!walletLoading">
            <button @click="onCreateWallet">
              Create new Wallet
            </button>
            <button @click="onLoadWallet">
              Load Wallet
            </button>
          </div>
          <div v-if="walletLoading" class="lds-ring">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
        <div class="wallet-funds">
          <h2>Funds: {{ funds.toFixed(2) }}</h2>
        </div>
      </div>
      <h2 v-if="!wallet">Create a Wallet to start sending coins or to mine coins!</h2>
      <form v-if="wallet" @submit.prevent="onSendTx">
        <label>
          Recipient Key
          <input v-model="outgoingTx.recipient" type="text" id="recipient" placeholder="Enter key">
        </label>
        <label>
          Amount of Coins
          <input v-model.number="outgoingTx.amount" type="number" step="0.001" id="amount">
        </label>
        <small>Fractions are possible (e.g. 5.67)</small>
        <div v-if="txLoading" class="lds-ring">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
        <button :disabled="txLoading || outgoingTx.recipient.trim() === '' || outgoingTx.amount <= 0" type="submit" class="btn btn-primary">Send</button>
      </form>
      <nav>
        <ul>
          <li>
            <a :class="{active: view === 'chain'}" href="#" @click="view = 'chain'">Blockchain</a>
          </li>
          <li>
            <a :class="{active: view === 'tx'}" href="#" @click="view = 'tx'">Open Transactions</a>
          </li>
        </ul>
      </nav>
      <button @click="onLoadData">{{ view === 'chain' ? 'Load Blockchain' : 'Load Transactions' }}</button>
      <button v-if="view === 'chain' && wallet" @click="onMine">Mine Coins</button>
      <button @click="onResolve">Resolve Conflicts</button>
      <div v-if="dataLoading" class="lds-ring">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div v-if="!dataLoading">
        <div v-for="(data, index) in loadedData">
          <div v-if="view === 'chain'" class="card-header">
            <button type="button" @click="showElement === index ? showElement = null : showElement = index">
              Block #{{ data.index }}
            </button>
          </div>
          <div v-if="view === 'chain'" class="collapse" :class="{show: showElement === index}">
            <p>Previous Hash: {{ data.previous_hash }}</p>
            <div v-for="tx in data.transactions">
              <div>Sender: {{ tx.sender }}</div>
              <div>Recipient: {{ tx.recipient }}</div>
              <div>Amount: {{ tx.amount }}</div>
            </div>
          </div>
          <div v-if="view === 'tx'">
            <button type="button" @click="showElement === index ? showElement = null : showElement = index">
              Transaction #{{ index }}
            </button>
          </div>
          <div v-if="view === 'tx'" :class="{show: showElement === index}">
            <div>Sender: {{ data.sender }}</div>
            <div>Recipient: {{ data.recipient }}</div>
            <div>Amount: {{ data.amount }}</div>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>

</html>
